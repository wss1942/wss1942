---
title: 互联网协议
author: 王书硕
type: posts
date: 2019-05-15T02:30:07+00:00
url: /internet-protocol-suite.html
categories:
  - 前端

---
> 阮一峰《互联网协议》[链接](http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html)

```
+--------------------+
|      网 落 层       |
+----------------+---+
                 |
                 v
            +----+-------------------+
            |     传 输 层            |
            +------------------------+

```

<figure class="wp-block-image"><img src="/uploads/2019/05/image-15.png" alt="" class="wp-image-377"   /> </figure> 

## 1、实体层

光缆、电缆、无线电波（网线，光纤、wifi）等物理手段，传输电信号0和1。

## 2、链接层 

单纯的0和1没有意义。“链接层”在“实体层”上方确定0和1的组合方式，每个电信号位的意义。

早期每个公司有自己的电信号组合方式，后来“以太网”协议逐渐占据主导地位。以太网规定，一组电信号组成一个数据包，叫做“帧”，每一帧分成两部分：标头（Head）和数据（Data）。<figure class="wp-block-image">

<img src="/uploads/2019/05/image-16.png" alt="" class="wp-image-380"   /> </figure> 

“标头”包含数据包的说明信息，比如发送者、接受者、数据类型等。

“数据”则是数据包的具体内容。

“标头”固定18字节，“数据”46-1500字节。如果数据过长，要分割成多个帧进行发送。

### MAC地址

上面提到，以太网数据包的&#8221;标头&#8221;，包含了发送者和接受者的信息。那么，发送者和接受者是如何标识呢？

以太网规定，连入网络的所有设备，都必须具有&#8221;网卡&#8221;接口。数据包必须是从一块网卡，传送到另一块网卡。网卡的地址，就是数据包的发送地址和接收地址，这叫做MAC地址。

每块网卡出厂的时候，都有一个全世界独一无二的MAC地址，长度是48个二进制位，通常用12个十六进制数表示。<figure class="wp-block-image">

<img src="/uploads/2019/05/image-17.png" alt="" class="wp-image-382"   /> </figure> 

前6个十六进制数是厂商编号，后6个是该厂商的网卡流水号。有了MAC地址，就可以定位网卡和数据包的路径了。

### 广播

以太网不会准确把数据包发送给接收方，它会向整个网络内的所有计算机发送数据包，由计算机自己判断是否为接收方。

> 为什么不准确的发送呢？广播的反义词是路由吗？

有了数据包的定义、网卡的MAC地址、广播的发送方式，&#8221;链接层&#8221;就可以在多台计算机之间传送数据了。

## 3、网络层

### 3.1、网络层的由来

以太网协议，依靠MAC地址发送数据包，而且限制在发送者所在的子网络。互联网是由无数子网络组成的，不同子网络的计算机，不能通过以太网协议发送数据包。

> 所以“以太网”的协议都规定了哪些事？1.根据mac地址发送数据包，2.现在子网络，3.？？？  
  
> 子网络是什么？怎么定义的？

所以不同子网络的计算机怎么办呢？又怎么区分哪些MAC地址属于同一子网络呢？

答案是创造一个“网络层 ”，它引入了一套新的地址，使得我们能够区分不同的计算机是否属于同一网络。这套地址叫做“网络地址”，简称“网址”。

所以每台计算机有两个地址，一个是MAC地址，另一个是网络地址。MAC绑定到网卡，网络地址由管理员分配。

网络地址帮助我们确定计算机所在的子网络，MAC地址将数据包发送到该子网络的网卡。

### 3.2、IP协议

#### 3.2.1、什么是IP协议

规定网络地址的协议叫做IP协议。它所定义的地址，叫做IP地址。

IP协议的第四版，简称IPv4。这个版本规定，网络地址由32个二进制位组成，习惯上，我们用4段10进制表示IP地址，从0.0.0.0一直到255.255.255.255。

#### 3.2.2、怎么通过IP地址确定子网络

一个IP地址分成两个部分，前一部分代表网络，后一部分代表主机。比如172.16.254.1中，前三段代表网络，最后一段代表主机。处于同一子网络的计算机，它们的网络部分一定是相同的，但不一定是由前三段代表网络部分。

<pre class="wp-block-verse">可能只是前2段？第一段？</pre>

所以需要一个参数来标记网络部分。这个参数叫“子网掩码”。

“子网掩码”形式上与IP地址一样，都是32位二进制数字。如果一个IP地址的前24位为网络部分，子网掩码表示为11111111.11111111.11111111.00000000 。这个子网掩码会与IP地址做**AND运算**，如果两个IP的结果相同，就表示在同一个子网络。

### 3.3 IP数据包

IP数据包与以太网数据包类似，也分为Head和Data两个部分。<figure class="wp-block-image">

<img src="/uploads/2019/05/image-18.png" alt="" class="wp-image-387"   /> </figure> 

Head部分主要包含版本、长度、IP地址等信息。Data部分为具体数据。它放进以太网数据包后，就成了这样：<figure class="wp-block-image">

<img src="/uploads/2019/05/image-19.png" alt="" class="wp-image-388"   /> </figure> 

IP数据包的Head部分长度为20-60字节，整个数据包最多65535字节。IP数据包可能会被分割成多个以太网数据包。